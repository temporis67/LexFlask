{% extends 'base.html' %}

{% block content %}

        <form action="" method="POST">
        <div class="container">


          <div class="A1">
              <h3 style='color: #ccc;font-size: 30px;'>No message yet..</h3>
              <div class="message_holder"></div>
          </div>
            <div class="A2">

                <textarea class="prompt_template" rows="15" cols="50"><s>[INST] <<SYS>>
You are a helpful, respectful and honest assistant.
Always answer as helpfully as possible, while being safe.
Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content.
Please ensure that your responses are socially unbiased and positive in nature.

If a question does not make any sense, or is not factually coherent,
explain why instead of answering something not correct.
If you don't know the answer to a question, please don't share false information but answer with "I don't know.".
Please answer in the same language as the user. Please answer in full sentences.

Use the following pieces of information to answer the user's question:
{context}
<</SYS>>

{question}[/INST] This is a answer </s>
                </textarea>
                <textarea  class="prompt_context" rows="15" cols="50">Der Name ist  WERNER Ludwig Alvo (Graf) Alvensleben.
Das Geburtsdatum von  WERNER Ludwig Alvo (Graf) Alvensleben ist 20.7.1840.
WERNER Ludwig Alvo (Graf) Alvensleben wurde am 20.7.1840  geboren.
Der Geburtsort von  WERNER Ludwig Alvo (Graf) Alvensleben ist  (Kreis Oschersleben, Sachsen).
Das Sterbedatum von  WERNER Ludwig Alvo (Graf) Alvensleben ist 19.2.1929 Neugattersleben (Kreis Oschersleben, Sachsen).
WERNER Ludwig Alvo (Graf) Alvensleben ist am 19.2.1929 Neugattersleben (Kreis Oschersleben, Sachsen) gestorben.
Der Grundbesitz von  WERNER Ludwig Alvo (Graf) Alvensleben ist Neugattersleben (seit 1869).
Die Religion von  WERNER Ludwig Alvo (Graf) Alvensleben ist evangelisch.
                </textarea>



            </div>
          <div class="A3">
              <input type="text" class="username" placeholder="User Name"/>
              <input type="text" class="message" placeholder="Messages"/>
              <input type="submit"/>

          </div>
          <div class="A4">
              <h4>Antwort</h4>
              <div class="answer_holder"></div>
          </div>


        </div>
        </form>
    <div>
        <p>
        Wie lautet der volle Name von Werner von Alvensleben?
        Wann lebte Werner von Alvensleben?
        </p>
    </div>



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type="text/javascript">
      var socket = io.connect('http://' + document.domain + ':' + location.port);

      socket.on( 'connect', function() {
        socket.emit( 'my event', {
          data: 'User Connected'
        } )

        var form = $( 'form' ).on( 'submit', function( e )
        {
            e.preventDefault()
            let user_name = $( 'input.username' ).val()
            let user_input = $( 'input.message' ).val()
            let user_prompt = $( 'textarea.prompt_template' ).val()
            let user_context = $( 'textarea.prompt_context' ).val()
            socket.emit( 'my event', {
                message : user_input,
                prompt : user_prompt, // WTF why is this not in the event load?
                context : user_context,
                user_name : user_name
            } )
            $( 'input.message' ).val( '' ).focus()
        } )
      } )

      socket.on( 'my response', function( msg ) {
        console.log( msg )
        if( typeof msg.user_name !== 'undefined' ) {
            $( 'h3' ).remove()
            $( 'div.message_holder' ).append( '<div><b style="color: #000">'+msg.user_name+'</b> '+msg.message+'</div>' )
            $( 'div.answer_holder' ).append( '<div><b style="color: #000">Jarvis:</b> '+msg.answer+'</div>' )
        }
      })
    </script>

{% endblock %}